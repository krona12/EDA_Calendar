# Krona T2101 EDA课设记录
## all rights reserved krona12
### 2023/12/8

## 思路
1. **写日期函数**
   - 计数器重构，BCD码转换。
   - 初始只取年份后两位，后续扩展到全部。
   - 重写BCD，实现四位数十进制（二进制表示）到BCD的转换。

2. **写星期函数**
   - 使用蔡勒公式（考虑Verilog除法局限性，舍去小数）。

3. **步进电机模拟秒针转动**

4. **扩展键盘**
   - 键盘与开关部分复用，保留4个开关，其余用键盘逻辑。
   - 键盘3个按键有效，其余可能因上拉电阻阻值问题无效。

5. **设计变速器**
   - 通过按键改变CP，使用计数器和数据选择器实现计数速度变化。

6. **完善闹钟与闹铃**
   - 将排线换为跳线以增加端口数量。

7. **扩展点阵**
   - 进行点阵扫描编码。

## 解决bug
1. 数码管显示“模糊”，由于使用未定义的变量。
2. 时分秒进位不准确，重写N位计数器。
3. BCD码转换错误，移位数位有误。
4. 星期转换问题，蔡乐公式应用错误，基于Verilog小数计算舍去的问题。
5. 时分秒进位给到天数，天数不能进位；使用同步进位输出为reg，避免竞争冒险。
6. 调整时间时出现跳变；采用按键消抖技术解决。

## 端口说明
- **ALARM A3**
  - 闹钟模块。因4个端口用于步进电机，故ALARM接至无用端口A3。
  - 接跳线后，闹钟、报时功能正常。

- **端口1.0**
  - M22-K1: 修改分钟。
  - N21-K2: 修改时钟。
  - ...（更多端口功能描述）...

- **端口2.0**
  - 前四个端口功能不变。
  - 新增键盘功能：5，6，7，10用单个键，8，9用于翻页。
  - AN4 CP加速，可调速度1, 2, 5, 10Hz。

## 接线说明
1. 先接数码管15个，DP端不接。
2. 接按键、键盘、按钮，除了J22,W20，K22外，其他正常接。
3. 接步进电机（4个管脚）。
4. 最后接点阵（H21,列; J22,R1; W20,R2; B21,R3; B22,R4; 0123）。

## 其他资源
- [关于烧录失败的bug](https://chipdebug.com/forum-post/20501.html)
- [键盘扫描参考](https://blog.51cto.com/u_15075516/4680301)
- [星期转换 - 蔡乐公式](https://www.luogu.com.cn/blog/holyromanempire/ji-suan-te-ding-ri-ji-shi-xing-ji-ji-cai-le-gong-shi)
- [BCD码转换讨论](#)
- [四线八相电机参考](https://blog.csdn.net/qq_35484725/article/details/118211352)
